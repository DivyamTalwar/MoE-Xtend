<svg width="1200" height="440" viewBox="0 0 1200 440" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#F8FAFC" />
      <stop offset="45%" stop-color="#E0F2FE" />
      <stop offset="100%" stop-color="#FCE7F3" />
    </linearGradient>
    <linearGradient id="accent" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#06B6D4" />
      <stop offset="50%" stop-color="#8B5CF6" />
      <stop offset="100%" stop-color="#F59E0B" />
    </linearGradient>
    <linearGradient id="accent2" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#06B6D4" />
      <stop offset="50%" stop-color="#8B5CF6" />
      <stop offset="100%" stop-color="#EC4899" />
    </linearGradient>
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#CBD5E1" stroke-width="1" />
    </pattern>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="8" stdDeviation="8" flood-color="#0B1220" flood-opacity="0.12" />
    </filter>
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="4" result="b" />
      <feColorMatrix in="b" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.55 0" result="g" />
      <feMerge>
        <feMergeNode in="g" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
    <linearGradient id="scan" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#FFFFFF" stop-opacity="0" />
      <stop offset="50%" stop-color="#FFFFFF" stop-opacity="0.35" />
      <stop offset="100%" stop-color="#FFFFFF" stop-opacity="0" />
    </linearGradient>
  </defs>

  <rect width="1200" height="440" fill="url(#bg)" />
  <rect width="1200" height="440" fill="url(#grid)" opacity="0.22" />

  <text x="60" y="66" fill="#0B1220" font-size="30" font-weight="800" font-family="Space Grotesk, Helvetica, Arial, sans-serif">Attention Stack (Long-Context)</text>
  <text x="60" y="98" fill="#334155" font-size="14" font-family="JetBrains Mono, 'Courier New', monospace">QKV -> RoPE -> GQA -> Mask/Sinks -> Softmax -> V. Bias terms implement windows and sinks as additive logits.</text>
  <rect x="60" y="118" width="1080" height="6" fill="url(#accent2)" />

  <!-- main card -->
  <g filter="url(#shadow)">
    <rect x="60" y="140" width="1080" height="270" rx="18" fill="#FFFFFF" opacity="0.66" stroke="#0B1220" stroke-width="2" />
  </g>

  <!-- pipeline boxes -->
  <g font-family="JetBrains Mono, 'Courier New', monospace" fill="#0B1220">
    <rect x="90" y="182" width="160" height="66" rx="14" fill="#FFFFFF" opacity="0.82" stroke="#0B1220" stroke-width="2" />
    <rect x="270" y="182" width="160" height="66" rx="14" fill="#FFFFFF" opacity="0.82" stroke="#0B1220" stroke-width="2" />
    <rect x="450" y="182" width="160" height="66" rx="14" fill="#FFFFFF" opacity="0.82" stroke="#0B1220" stroke-width="2" />
    <rect x="630" y="182" width="190" height="66" rx="14" fill="#FFFFFF" opacity="0.82" stroke="#0B1220" stroke-width="2" />
    <rect x="840" y="182" width="270" height="66" rx="14" fill="#FFFFFF" opacity="0.86" stroke="url(#accent2)" stroke-width="3" />

    <text x="110" y="212" font-size="13" font-weight="800">QKV</text>
    <text x="110" y="236" font-size="11" fill="#334155">Q=XWq K=XWk V=XWv</text>

    <text x="290" y="212" font-size="13" font-weight="800">RoPE</text>
    <text x="290" y="236" font-size="11" fill="#334155">rotate pairs by pos</text>

    <text x="470" y="212" font-size="13" font-weight="800">GQA</text>
    <text x="470" y="236" font-size="11" fill="#334155">share KV across Q</text>

    <text x="650" y="212" font-size="13" font-weight="800">MASK+SINKS</text>
    <text x="650" y="236" font-size="11" fill="#334155">window + global tokens</text>

    <text x="860" y="212" font-size="13" font-weight="800">SOFTMAX + OUTPUT</text>
    <text x="860" y="236" font-size="11" fill="#334155">A=softmax((QK^T)/sqrt(d)+B)</text>
  </g>

  <!-- connectors + pulse -->
  <g stroke="url(#accent)" stroke-width="4" stroke-linecap="round" fill="none" opacity="0.9">
    <path id="p1" d="M250 215 C 262 215, 268 215, 270 215" />
    <path id="p2" d="M430 215 C 442 215, 448 215, 450 215" />
    <path id="p3" d="M610 215 C 622 215, 628 215, 630 215" />
    <path id="p4" d="M820 215 C 832 215, 838 215, 840 215" />
  </g>
  <g filter="url(#glow)">
    <circle r="7" fill="#06B6D4"><animateMotion path="M250 215 C 262 215, 268 215, 270 215" dur="0.9s" repeatCount="indefinite" /></circle>
    <circle r="7" fill="#8B5CF6"><animateMotion path="M430 215 C 442 215, 448 215, 450 215" dur="0.9s" begin="0.2s" repeatCount="indefinite" /></circle>
    <circle r="7" fill="#F59E0B"><animateMotion path="M610 215 C 622 215, 628 215, 630 215" dur="0.9s" begin="0.4s" repeatCount="indefinite" /></circle>
    <circle r="7" fill="#EC4899"><animateMotion path="M820 215 C 832 215, 838 215, 840 215" dur="0.9s" begin="0.6s" repeatCount="indefinite" /></circle>
  </g>

  <!-- bias decomposition callout -->
  <g filter="url(#shadow)">
    <rect x="90" y="272" width="1020" height="118" rx="16" fill="#FFFFFF" opacity="0.70" stroke="#0B1220" stroke-width="2" />
  </g>
  <rect x="90" y="272" width="1020" height="6" rx="16" fill="url(#accent2)" opacity="0.9" />
  <g font-family="JetBrains Mono, 'Courier New', monospace" fill="#0B1220">
    <text x="112" y="306" font-size="14" font-weight="800">Bias Terms (B) = causal + window + sinks</text>
    <g font-size="12" fill="#334155">
      <text x="112" y="330">B = M_causal + M_window + M_sinks</text>
      <text x="112" y="352">M_causal(i,j) = 0 if j&lt;=i else -inf</text>
      <text x="112" y="372">M_window(i,j) = 0 if i-W&lt;=j&lt;=i else -inf  (for windowed layers)</text>
      <text x="620" y="352">M_sinks: allow global attention to early tokens (stabilizes long decode)</text>
      <text x="620" y="372">GQA: H_q queries share H_kv keys/values to reduce bandwidth</text>
    </g>
  </g>

  <!-- scanline -->
  <rect x="60" y="140" width="1080" height="36" fill="url(#scan)" opacity="0.22">
    <animate attributeName="y" dur="6.4s" repeatCount="indefinite" values="140;370;140" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
  </rect>

  <g font-family="JetBrains Mono, 'Courier New', monospace" font-size="12" fill="#334155">
    <text x="60" y="434">implementation: masks are additive bias before softmax. keep deterministic behavior for research runs.</text>
  </g>
</svg>
