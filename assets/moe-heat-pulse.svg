<svg width="1200" height="420" viewBox="0 0 1200 420" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#F8FAFC" />
      <stop offset="45%" stop-color="#E0F2FE" />
      <stop offset="100%" stop-color="#FCE7F3" />
    </linearGradient>
    <linearGradient id="accent" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#06B6D4" />
      <stop offset="50%" stop-color="#8B5CF6" />
      <stop offset="100%" stop-color="#EC4899" />
    </linearGradient>
    <linearGradient id="scan" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#FFFFFF" stop-opacity="0" />
      <stop offset="50%" stop-color="#FFFFFF" stop-opacity="0.35" />
      <stop offset="100%" stop-color="#FFFFFF" stop-opacity="0" />
    </linearGradient>
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#CBD5E1" stroke-width="1" />
    </pattern>
    <pattern id="heatgrid" width="60" height="18" patternUnits="userSpaceOnUse">
      <path d="M 60 0 H 0 V 18" fill="none" stroke="#94A3B8" stroke-width="1" opacity="0.35" />
    </pattern>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="8" stdDeviation="8" flood-color="#0B1220" flood-opacity="0.12" />
    </filter>
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="5" result="b" />
      <feColorMatrix in="b" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.6 0" result="g" />
      <feMerge>
        <feMergeNode in="g" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
    <radialGradient id="pulse" cx="50%" cy="50%" r="55%">
      <stop offset="0%" stop-color="#EC4899" stop-opacity="0.55" />
      <stop offset="55%" stop-color="#8B5CF6" stop-opacity="0.22" />
      <stop offset="100%" stop-color="#06B6D4" stop-opacity="0" />
    </radialGradient>
  </defs>

  <rect width="1200" height="420" fill="url(#bg)" />
  <rect width="1200" height="420" fill="url(#grid)" opacity="0.22" />

  <text x="60" y="66" fill="#0B1220" font-size="28" font-weight="800" font-family="Space Grotesk, Helvetica, Arial, sans-serif">MoE Expert Routing: Heat Pulse Sweep</text>
  <text x="60" y="98" fill="#334155" font-size="14" font-family="JetBrains Mono, 'Courier New', monospace">Top-k routing creates sparse activation. A sweeping pulse visualizes token-time drift of selected experts.</text>
  <rect x="60" y="118" width="1080" height="6" fill="url(#accent)" />

  <!-- main heatmap card -->
  <g filter="url(#shadow)">
    <rect x="60" y="140" width="820" height="240" rx="18" fill="#FFFFFF" opacity="0.66" stroke="#0B1220" stroke-width="2" />
  </g>

  <!-- right callouts -->
  <g filter="url(#shadow)">
    <rect x="900" y="140" width="240" height="240" rx="18" fill="#FFFFFF" opacity="0.66" stroke="#0B1220" stroke-width="2" />
    <rect x="900" y="140" width="240" height="6" rx="18" fill="url(#accent)" />
    <text x="922" y="172" fill="#0B1220" font-size="14" font-weight="800" font-family="JetBrains Mono, 'Courier New', monospace">Router View</text>
    <g font-family="JetBrains Mono, 'Courier New', monospace" font-size="12" fill="#334155">
      <text x="922" y="198">s = W_r x_t</text>
      <text x="922" y="218">I = topk(s, k)</text>
      <text x="922" y="238">w = softmax(s[I])</text>
      <text x="922" y="258">y = sum_i w_i E_i(x_t)</text>
      <text x="922" y="290">k small -> sparse compute</text>
      <text x="922" y="310">aux loss -> balance load</text>
      <text x="922" y="330">capacity -> avoid overflow</text>
    </g>
  </g>

  <!-- heatmap canvas -->
  <g>
    <text x="92" y="170" fill="#0B1220" font-size="13" font-weight="800" font-family="JetBrains Mono, 'Courier New', monospace">Experts (rows) x Tokens (cols)</text>

    <rect x="110" y="190" width="760" height="160" rx="12" fill="#FFFFFF" opacity="0.75" stroke="#0B1220" stroke-width="2" />
    <rect x="110" y="190" width="760" height="160" rx="12" fill="url(#heatgrid)" opacity="0.9" />

    <!-- sparse activations (top-k picks) -->
    <g stroke="#0B1220" stroke-width="1">
      <rect x="118" y="198" width="54" height="14" rx="4" fill="#BAE6FD" opacity="0.85" />
      <rect x="238" y="216" width="54" height="14" rx="4" fill="#DDD6FE" opacity="0.85" />
      <rect x="358" y="234" width="54" height="14" rx="4" fill="#FBCFE8" opacity="0.85" />
      <rect x="478" y="252" width="54" height="14" rx="4" fill="#BAE6FD" opacity="0.85" />
      <rect x="598" y="270" width="54" height="14" rx="4" fill="#DDD6FE" opacity="0.85" />
      <rect x="718" y="288" width="54" height="14" rx="4" fill="#FBCFE8" opacity="0.85" />

      <rect x="178" y="252" width="54" height="14" rx="4" fill="#FBCFE8" opacity="0.65" />
      <rect x="298" y="270" width="54" height="14" rx="4" fill="#BAE6FD" opacity="0.65" />
      <rect x="418" y="288" width="54" height="14" rx="4" fill="#DDD6FE" opacity="0.65" />
      <rect x="538" y="306" width="54" height="14" rx="4" fill="#FBCFE8" opacity="0.65" />
      <rect x="658" y="324" width="54" height="14" rx="4" fill="#BAE6FD" opacity="0.65" />

      <rect x="598" y="216" width="54" height="14" rx="4" fill="#BAE6FD" opacity="0.45" />
      <rect x="418" y="198" width="54" height="14" rx="4" fill="#DDD6FE" opacity="0.45" />
      <rect x="778" y="234" width="54" height="14" rx="4" fill="#FBCFE8" opacity="0.45" />
    </g>

    <!-- pulsing picks (emphasize top-k) -->
    <g filter="url(#glow)">
      <rect x="358" y="234" width="54" height="14" rx="4" fill="url(#accent)" opacity="0.0">
        <animate attributeName="opacity" values="0;0.85;0" dur="2.2s" repeatCount="indefinite" />
      </rect>
      <rect x="478" y="252" width="54" height="14" rx="4" fill="url(#accent)" opacity="0.0">
        <animate attributeName="opacity" values="0;0.85;0" dur="2.2s" begin="0.4s" repeatCount="indefinite" />
      </rect>
      <rect x="598" y="270" width="54" height="14" rx="4" fill="url(#accent)" opacity="0.0">
        <animate attributeName="opacity" values="0;0.85;0" dur="2.2s" begin="0.8s" repeatCount="indefinite" />
      </rect>
    </g>

    <!-- sweeping heat pulse band -->
    <g filter="url(#glow)">
      <rect x="40" y="190" width="160" height="160" fill="url(#accent)" opacity="0.18">
        <animate attributeName="x" dur="5.2s" repeatCount="indefinite" values="50;730;50" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
      </rect>
      <circle cx="160" cy="270" r="90" fill="url(#pulse)" opacity="0.75">
        <animate attributeName="cx" dur="5.2s" repeatCount="indefinite" values="160;790;160" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
      </circle>
    </g>

    <!-- scanline -->
    <rect x="110" y="190" width="760" height="28" fill="url(#scan)" opacity="0.35">
      <animate attributeName="y" dur="4.6s" repeatCount="indefinite" values="190;322;190" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
    </rect>

    <!-- axis hints -->
    <g font-family="JetBrains Mono, 'Courier New', monospace" font-size="11" fill="#334155">
      <text x="110" y="366">left: early tokens</text>
      <text x="710" y="366">right: later tokens</text>
      <text x="110" y="384">sparse activations (colored) + moving pulse band (router drift)</text>
    </g>
  </g>
</svg>
