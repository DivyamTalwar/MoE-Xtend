<svg width="1200" height="520" viewBox="0 0 1200 520" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#F8FAFC" />
      <stop offset="45%" stop-color="#E0F2FE" />
      <stop offset="100%" stop-color="#FCE7F3" />
    </linearGradient>
    <linearGradient id="accent" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#06B6D4" />
      <stop offset="50%" stop-color="#8B5CF6" />
      <stop offset="100%" stop-color="#EC4899" />
    </linearGradient>
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#CBD5E1" stroke-width="1" />
    </pattern>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="8" stdDeviation="8" flood-color="#0B1220" flood-opacity="0.12" />
    </filter>
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="4" result="b" />
      <feColorMatrix in="b" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.55 0" result="g" />
      <feMerge>
        <feMergeNode in="g" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
    <linearGradient id="scan" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#FFFFFF" stop-opacity="0" />
      <stop offset="50%" stop-color="#FFFFFF" stop-opacity="0.35" />
      <stop offset="100%" stop-color="#FFFFFF" stop-opacity="0" />
    </linearGradient>
  </defs>

  <rect width="1200" height="520" fill="url(#bg)" />
  <rect width="1200" height="520" fill="url(#grid)" opacity="0.22" />

  <text x="60" y="66" fill="#0B1220" font-size="30" font-weight="800" font-family="Space Grotesk, Helvetica, Arial, sans-serif">System Architecture</text>
  <text x="60" y="100" fill="#334155" font-size="14" font-family="JetBrains Mono, 'Courier New', monospace">Harmony formatting -> tokenization -> MoE transformer stack -> deterministic sampling -> structured outputs.</text>
  <rect x="60" y="120" width="1080" height="6" fill="url(#accent)" />

  <!-- main card -->
  <g filter="url(#shadow)">
    <rect x="60" y="146" width="1080" height="334" rx="18" fill="#FFFFFF" opacity="0.66" stroke="#0B1220" stroke-width="2" />
  </g>

  <!-- pipeline boxes -->
  <g font-family="JetBrains Mono, 'Courier New', monospace" fill="#0B1220">
    <rect x="90" y="186" width="150" height="70" rx="14" fill="#FFFFFF" opacity="0.82" stroke="#0B1220" stroke-width="2" />
    <rect x="270" y="186" width="150" height="70" rx="14" fill="#FFFFFF" opacity="0.82" stroke="#0B1220" stroke-width="2" />
    <rect x="450" y="176" width="300" height="90" rx="14" fill="#FFFFFF" opacity="0.86" stroke="url(#accent)" stroke-width="3" />
    <rect x="780" y="186" width="190" height="70" rx="14" fill="#FFFFFF" opacity="0.82" stroke="#0B1220" stroke-width="2" />
    <rect x="1000" y="186" width="140" height="70" rx="14" fill="#FFFFFF" opacity="0.82" stroke="#0B1220" stroke-width="2" />

    <text x="106" y="214" font-size="13" font-weight="800">HARMONY</text>
    <text x="106" y="236" font-size="11" fill="#334155">structured prompt</text>

    <text x="286" y="214" font-size="13" font-weight="800">TOKENS</text>
    <text x="286" y="236" font-size="11" fill="#334155">ids + mask</text>

    <text x="470" y="206" font-size="13" font-weight="800">MoE TRANSFORMER STACK</text>
    <text x="470" y="230" font-size="11" fill="#334155">attn (RoPE/GQA/window/sinks) + MoE (top-k)</text>
    <text x="470" y="252" font-size="11" fill="#334155">KV cache: prefill once, decode append</text>

    <text x="796" y="214" font-size="13" font-weight="800">SAMPLER</text>
    <text x="796" y="236" font-size="11" fill="#334155">temp/top-p/min-p</text>

    <text x="1016" y="214" font-size="13" font-weight="800">OUTPUT</text>
    <text x="1016" y="236" font-size="11" fill="#334155">text/JSON</text>
  </g>

  <!-- stack mini-layers (animated highlight) -->
  <g>
    <g opacity="0.95">
      <rect x="470" y="262" width="260" height="10" rx="5" fill="#E2E8F0" />
      <rect x="470" y="276" width="260" height="10" rx="5" fill="#E2E8F0" />
      <rect x="470" y="290" width="260" height="10" rx="5" fill="#E2E8F0" />
      <rect x="470" y="304" width="260" height="10" rx="5" fill="#E2E8F0" />
      <rect x="470" y="318" width="260" height="10" rx="5" fill="#E2E8F0" />
      <rect x="470" y="332" width="260" height="10" rx="5" fill="#E2E8F0" />
    </g>
    <rect x="470" y="262" width="260" height="10" rx="5" fill="url(#accent)" opacity="0.0" filter="url(#glow)">
      <animate attributeName="y" values="262;276;290;304;318;332;262" dur="2.6s" repeatCount="indefinite" />
      <animate attributeName="opacity" values="0.0;0.85;0.0" dur="2.6s" repeatCount="indefinite" />
    </rect>
  </g>

  <!-- arrows + moving dot -->
  <g stroke="url(#accent)" stroke-width="4" stroke-linecap="round" fill="none" opacity="0.9">
    <path id="a1" d="M240 221 C 252 221, 260 221, 270 221" />
    <path id="a2" d="M420 221 C 434 221, 440 221, 450 221" />
    <path id="a3" d="M750 221 C 764 221, 770 221, 780 221" />
    <path id="a4" d="M970 221 C 984 221, 990 221, 1000 221" />
  </g>
  <g filter="url(#glow)">
    <circle r="7" fill="#0B1220" opacity="0.75">
      <animateMotion path="M240 221 C 252 221, 260 221, 270 221" dur="0.8s" repeatCount="indefinite" />
    </circle>
    <circle r="7" fill="#06B6D4" opacity="0.95">
      <animateMotion path="M420 221 C 434 221, 440 221, 450 221" dur="0.8s" begin="0.2s" repeatCount="indefinite" />
    </circle>
    <circle r="7" fill="#8B5CF6" opacity="0.95">
      <animateMotion path="M750 221 C 764 221, 770 221, 780 221" dur="0.8s" begin="0.4s" repeatCount="indefinite" />
    </circle>
    <circle r="7" fill="#EC4899" opacity="0.95">
      <animateMotion path="M970 221 C 984 221, 990 221, 1000 221" dur="0.8s" begin="0.6s" repeatCount="indefinite" />
    </circle>
  </g>

  <!-- prefill vs decode cards -->
  <g filter="url(#shadow)">
    <rect x="90" y="286" width="500" height="170" rx="16" fill="#FFFFFF" opacity="0.70" stroke="#0B1220" stroke-width="2" />
    <rect x="610" y="286" width="530" height="170" rx="16" fill="#FFFFFF" opacity="0.70" stroke="#0B1220" stroke-width="2" />
  </g>
  <rect x="90" y="286" width="500" height="6" rx="16" fill="#06B6D4" opacity="0.9" />
  <rect x="610" y="286" width="530" height="6" rx="16" fill="#EC4899" opacity="0.9" />

  <g font-family="JetBrains Mono, 'Courier New', monospace" fill="#0B1220">
    <text x="112" y="320" font-size="14" font-weight="800">PREFILL</text>
    <text x="632" y="320" font-size="14" font-weight="800">DECODE</text>
    <g font-size="12" fill="#334155">
      <text x="112" y="346">build KV for prompt once</text>
      <text x="112" y="366">full layers: O(L^2) attention</text>
      <text x="112" y="386">write KV in chunks for long L</text>

      <text x="632" y="346">append 1 token per step</text>
      <text x="632" y="366">windowed layers: O(W) per step</text>
      <text x="632" y="386">offset++ and keep absolute RoPE</text>
    </g>
  </g>

  <!-- decode pointer animation -->
  <g>
    <rect x="632" y="404" width="470" height="26" rx="10" fill="#E2E8F0" stroke="#0B1220" stroke-width="1" opacity="0.9" />
    <rect x="640" y="410" width="18" height="14" rx="6" fill="url(#accent)" filter="url(#glow)">
      <animate attributeName="x" values="640;1080;640" dur="5.2s" repeatCount="indefinite" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
    </rect>
    <text x="112" y="416" font-family="JetBrains Mono, 'Courier New', monospace" font-size="11" fill="#334155">TTFT dominated by prefill; steady-state dominated by decode step cost</text>
  </g>

  <!-- scanline -->
  <rect x="60" y="146" width="1080" height="36" fill="url(#scan)" opacity="0.24">
    <animate attributeName="y" dur="6.2s" repeatCount="indefinite" values="146;414;146" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
  </rect>
</svg>
