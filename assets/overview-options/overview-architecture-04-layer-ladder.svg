<svg width="1200" height="560" viewBox="0 0 1200 560" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#F8FAFC" />
      <stop offset="45%" stop-color="#E0F2FE" />
      <stop offset="100%" stop-color="#FCE7F3" />
    </linearGradient>
    <linearGradient id="accent" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#06B6D4" />
      <stop offset="50%" stop-color="#8B5CF6" />
      <stop offset="100%" stop-color="#EC4899" />
    </linearGradient>
    <linearGradient id="scan" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#FFFFFF" stop-opacity="0" />
      <stop offset="50%" stop-color="#FFFFFF" stop-opacity="0.38" />
      <stop offset="100%" stop-color="#FFFFFF" stop-opacity="0" />
    </linearGradient>
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#CBD5E1" stroke-width="1" />
    </pattern>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="10" stdDeviation="10" flood-color="#0B1220" flood-opacity="0.14" />
    </filter>
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="5" result="b" />
      <feColorMatrix in="b" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.65 0" result="g" />
      <feMerge>
        <feMergeNode in="g" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
  </defs>

  <rect width="1200" height="560" fill="url(#bg)" />
  <rect width="1200" height="560" fill="url(#grid)" opacity="0.25" />

  <text x="60" y="70" fill="#0B1220" font-size="34" font-weight="800" font-family="Space Grotesk, Helvetica, Arial, sans-serif">MoE-Xtend: Layer Ladder (Attention -&gt; MoE Alternation)</text>
  <text x="60" y="104" fill="#334155" font-size="14" font-family="JetBrains Mono, 'Courier New', monospace">A layer-by-layer view: alternating attention/windowing and top-k experts, with a scan that follows the decode step.</text>
  <rect x="60" y="124" width="1080" height="6" fill="url(#accent)" />

  <!-- main card -->
  <g filter="url(#shadow)">
    <rect x="60" y="150" width="1080" height="360" rx="22" fill="#FFFFFF" opacity="0.66" stroke="#0B1220" stroke-width="2" />
  </g>

  <!-- left ladder card -->
  <g filter="url(#shadow)">
    <rect x="92" y="188" width="420" height="300" rx="18" fill="#FFFFFF" opacity="0.72" stroke="#0B1220" stroke-width="2" />
  </g>
  <rect x="92" y="188" width="420" height="6" rx="18" fill="url(#accent)" opacity="0.92" />

  <g font-family="JetBrains Mono, 'Courier New', monospace" fill="#0B1220">
    <text x="114" y="220" font-size="14" font-weight="800">Layer Stack</text>
    <text x="114" y="242" font-size="12" fill="#334155">decode step touches every layer</text>
  </g>

  <!-- ladder blocks -->
  <g font-family="JetBrains Mono, 'Courier New', monospace" font-size="11" fill="#0B1220" stroke="#0B1220" stroke-width="1">
    <g id="ladder" transform="translate(114, 262)">
      <!-- 12 rows -->
      <g>
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#BAE6FD" opacity="0.65" />
        <text x="10" y="13" fill="#0B1220">Attn (dense/window) + sinks</text>
      </g>
      <g transform="translate(0, 22)">
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#FBCFE8" opacity="0.55" />
        <text x="10" y="13" fill="#0B1220">MoE top-k + SwiGLU</text>
      </g>
      <g transform="translate(0, 44)">
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#BAE6FD" opacity="0.65" />
        <text x="10" y="13" fill="#0B1220">Attn (dense/window) + RoPE</text>
      </g>
      <g transform="translate(0, 66)">
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#FBCFE8" opacity="0.55" />
        <text x="10" y="13" fill="#0B1220">MoE top-k + merge weights</text>
      </g>
      <g transform="translate(0, 88)">
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#BAE6FD" opacity="0.65" />
        <text x="10" y="13" fill="#0B1220">Attn (window W=128)</text>
      </g>
      <g transform="translate(0, 110)">
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#FBCFE8" opacity="0.55" />
        <text x="10" y="13" fill="#0B1220">MoE dispatch (selected experts)</text>
      </g>
      <g transform="translate(0, 132)">
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#BAE6FD" opacity="0.65" />
        <text x="10" y="13" fill="#0B1220">Attn (dense) for mixing</text>
      </g>
      <g transform="translate(0, 154)">
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#FBCFE8" opacity="0.55" />
        <text x="10" y="13" fill="#0B1220">MoE (capacity + balance terms)</text>
      </g>
      <g transform="translate(0, 176)">
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#BAE6FD" opacity="0.65" />
        <text x="10" y="13" fill="#0B1220">Attn (GQA KV sharing)</text>
      </g>
      <g transform="translate(0, 198)">
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#FBCFE8" opacity="0.55" />
        <text x="10" y="13" fill="#0B1220">MoE (experts_per_token=k)</text>
      </g>
      <g transform="translate(0, 220)">
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#BAE6FD" opacity="0.65" />
        <text x="10" y="13" fill="#0B1220">Attn (mask correctness)</text>
      </g>
      <g transform="translate(0, 242)">
        <rect x="0" y="0" width="380" height="18" rx="8" fill="#FBCFE8" opacity="0.55" />
        <text x="10" y="13" fill="#0B1220">MoE (final merge -&gt; resid)</text>
      </g>

      <!-- scanning highlight -->
      <rect x="0" y="0" width="380" height="18" rx="8" fill="url(#accent)" opacity="0.0" filter="url(#glow)">
        <animate attributeName="y" values="0;22;44;66;88;110;132;154;176;198;220;242;0" dur="3.6s" repeatCount="indefinite" />
        <animate attributeName="opacity" values="0.0;0.38;0.0" dur="0.6s" repeatCount="indefinite" />
      </rect>
    </g>
  </g>

  <!-- token dot flowing down -->
  <g filter="url(#glow)">
    <circle cx="110" cy="270" r="7" fill="#06B6D4">
      <animate attributeName="cy" values="270;474;270" dur="3.6s" repeatCount="indefinite" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
    </circle>
  </g>

  <!-- right notes card -->
  <g filter="url(#shadow)">
    <rect x="540" y="188" width="570" height="300" rx="18" fill="#FFFFFF" opacity="0.72" stroke="#0B1220" stroke-width="2" />
  </g>
  <rect x="540" y="188" width="570" height="6" rx="18" fill="url(#accent)" opacity="0.92" />

  <g font-family="JetBrains Mono, 'Courier New', monospace" fill="#0B1220">
    <text x="562" y="220" font-size="14" font-weight="800">What Matters in Long Context</text>
    <g font-size="12" fill="#334155">
      <text x="562" y="246">1) RoPE absolute position must match KV offset</text>
      <text x="562" y="268">2) mask diagonals: causal + window boundaries</text>
      <text x="562" y="290">3) sinks: stabilize long decode (avoid attention drift)</text>
      <text x="562" y="312">4) GQA: reduce KV heads for bandwidth + memory</text>
      <text x="562" y="334">5) MoE routing: top-k ties can change outputs</text>
      <text x="562" y="356">6) sampling: min-p/top-p/penalties define stability</text>
    </g>

    <text x="562" y="392" font-size="14" font-weight="800">Mini Equations</text>
    <g font-size="12" fill="#334155">
      <text x="562" y="418">A = softmax((QK^T)/sqrt(d) + B)</text>
      <text x="562" y="440">s=W_r x_t; I=topk(s,k); y=sum w_i E_i(x)</text>
      <text x="562" y="462">KV bytes ~= 2*L*B*T*H_kv*d*dtype_bytes</text>
    </g>
  </g>

  <!-- scanline -->
  <rect x="60" y="150" width="1080" height="42" fill="url(#scan)" opacity="0.22">
    <animate attributeName="y" dur="7.2s" repeatCount="indefinite" values="150;468;150" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
  </rect>

  <text x="60" y="548" fill="#334155" font-size="12" font-family="JetBrains Mono, 'Courier New', monospace">Option 04: layer ladder (alternating blocks + decode scan).</text>
</svg>
