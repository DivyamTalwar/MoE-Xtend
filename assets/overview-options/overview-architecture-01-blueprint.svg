<svg width="1200" height="560" viewBox="0 0 1200 560" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#F8FAFC" />
      <stop offset="45%" stop-color="#E0F2FE" />
      <stop offset="100%" stop-color="#FCE7F3" />
    </linearGradient>
    <linearGradient id="accent" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#06B6D4" />
      <stop offset="50%" stop-color="#8B5CF6" />
      <stop offset="100%" stop-color="#EC4899" />
    </linearGradient>
    <linearGradient id="scan" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#FFFFFF" stop-opacity="0" />
      <stop offset="50%" stop-color="#FFFFFF" stop-opacity="0.38" />
      <stop offset="100%" stop-color="#FFFFFF" stop-opacity="0" />
    </linearGradient>
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#CBD5E1" stroke-width="1" />
    </pattern>
    <pattern id="cellgrid" width="18" height="18" patternUnits="userSpaceOnUse">
      <path d="M 18 0 H 0 V 18" fill="none" stroke="#94A3B8" stroke-width="1" opacity="0.26" />
    </pattern>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="10" stdDeviation="10" flood-color="#0B1220" flood-opacity="0.14" />
    </filter>
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="5" result="b" />
      <feColorMatrix in="b" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.65 0" result="g" />
      <feMerge>
        <feMergeNode in="g" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
    <clipPath id="clipAttn">
      <rect x="520" y="380" width="240" height="120" rx="14" />
    </clipPath>
  </defs>

  <rect width="1200" height="560" fill="url(#bg)" />
  <rect width="1200" height="560" fill="url(#grid)" opacity="0.25" />

  <text x="60" y="70" fill="#0B1220" font-size="34" font-weight="800" font-family="Space Grotesk, Helvetica, Arial, sans-serif">MoE-Xtend: End-to-End System Blueprint</text>
  <text x="60" y="104" fill="#334155" font-size="14" font-family="JetBrains Mono, 'Courier New', monospace">A single picture of the entire inference loop: Harmony prompt -&gt; tokens -&gt; attention+MoE -&gt; sampling -&gt; structured outputs.</text>
  <rect x="60" y="124" width="1080" height="6" fill="url(#accent)" />

  <!-- main card -->
  <g filter="url(#shadow)">
    <rect x="60" y="150" width="1080" height="360" rx="22" fill="#FFFFFF" opacity="0.66" stroke="#0B1220" stroke-width="2" />
  </g>

  <!-- pipeline row -->
  <g font-family="JetBrains Mono, 'Courier New', monospace" fill="#0B1220">
    <rect x="92" y="188" width="160" height="74" rx="16" fill="#FFFFFF" opacity="0.84" stroke="#0B1220" stroke-width="2" />
    <rect x="272" y="188" width="160" height="74" rx="16" fill="#FFFFFF" opacity="0.84" stroke="#0B1220" stroke-width="2" />
    <rect x="452" y="178" width="320" height="94" rx="16" fill="#FFFFFF" opacity="0.88" stroke="url(#accent)" stroke-width="3" />
    <rect x="792" y="188" width="170" height="74" rx="16" fill="#FFFFFF" opacity="0.84" stroke="#0B1220" stroke-width="2" />
    <rect x="982" y="188" width="130" height="74" rx="16" fill="#FFFFFF" opacity="0.84" stroke="#0B1220" stroke-width="2" />

    <text x="110" y="218" font-size="13" font-weight="800">HARMONY</text>
    <text x="110" y="240" font-size="11" fill="#334155">messages -&gt; spec</text>

    <text x="290" y="218" font-size="13" font-weight="800">TOKENS</text>
    <text x="290" y="240" font-size="11" fill="#334155">ids + masks</text>

    <text x="472" y="210" font-size="13" font-weight="800">TRANSFORMER STACK</text>
    <text x="472" y="232" font-size="11" fill="#334155">attention (RoPE/GQA/window/sinks)</text>
    <text x="472" y="252" font-size="11" fill="#334155">MoE (top-k) + KV cache discipline</text>

    <text x="810" y="218" font-size="13" font-weight="800">SAMPLER</text>
    <text x="810" y="240" font-size="11" fill="#334155">top-p/min-p/penalties</text>

    <text x="1000" y="218" font-size="13" font-weight="800">OUTPUT</text>
    <text x="1000" y="240" font-size="11" fill="#334155">text + JSON</text>
  </g>

  <!-- connectors -->
  <g stroke="url(#accent)" stroke-width="4" stroke-linecap="round" fill="none" opacity="0.92">
    <path id="p1" d="M252 225 C 262 225, 268 225, 272 225" />
    <path id="p2" d="M432 225 C 442 225, 448 225, 452 225" />
    <path id="p3" d="M772 225 C 782 225, 788 225, 792 225" />
    <path id="p4" d="M962 225 C 972 225, 978 225, 982 225" />
  </g>

  <!-- flowing packet dots -->
  <g filter="url(#glow)">
    <circle r="7" fill="#06B6D4"><animateMotion path="M252 225 C 262 225, 268 225, 272 225" dur="0.8s" repeatCount="indefinite" /></circle>
    <circle r="7" fill="#8B5CF6"><animateMotion path="M432 225 C 442 225, 448 225, 452 225" dur="0.8s" begin="0.22s" repeatCount="indefinite" /></circle>
    <circle r="7" fill="#EC4899"><animateMotion path="M772 225 C 782 225, 788 225, 792 225" dur="0.8s" begin="0.44s" repeatCount="indefinite" /></circle>
    <circle r="7" fill="#0B1220" opacity="0.82"><animateMotion path="M962 225 C 972 225, 978 225, 982 225" dur="0.8s" begin="0.66s" repeatCount="indefinite" /></circle>
  </g>

  <!-- mini stack bars inside transformer block -->
  <g>
    <g opacity="0.95">
      <rect x="480" y="278" width="264" height="10" rx="5" fill="#E2E8F0" />
      <rect x="480" y="292" width="264" height="10" rx="5" fill="#E2E8F0" />
      <rect x="480" y="306" width="264" height="10" rx="5" fill="#E2E8F0" />
      <rect x="480" y="320" width="264" height="10" rx="5" fill="#E2E8F0" />
      <rect x="480" y="334" width="264" height="10" rx="5" fill="#E2E8F0" />
      <rect x="480" y="348" width="264" height="10" rx="5" fill="#E2E8F0" />
    </g>
    <rect x="480" y="278" width="264" height="10" rx="5" fill="url(#accent)" opacity="0.0" filter="url(#glow)">
      <animate attributeName="y" values="278;292;306;320;334;348;278" dur="2.8s" repeatCount="indefinite" />
      <animate attributeName="opacity" values="0.0;0.85;0.0" dur="2.8s" repeatCount="indefinite" />
    </rect>
  </g>

  <!-- bottom micro-panels -->
  <g font-family="JetBrains Mono, 'Courier New', monospace">
    <!-- MoE router pulse panel -->
    <g filter="url(#shadow)">
      <rect x="92" y="308" width="400" height="192" rx="18" fill="#FFFFFF" opacity="0.70" stroke="#0B1220" stroke-width="2" />
    </g>
    <rect x="92" y="308" width="400" height="6" rx="18" fill="url(#accent)" opacity="0.92" />
    <text x="112" y="340" font-size="14" font-weight="800" fill="#0B1220">MoE Router Trace</text>
    <text x="112" y="362" font-size="12" fill="#334155">top-k experts fire per token (sparse compute)</text>

    <rect x="112" y="378" width="360" height="92" rx="14" fill="#F1F5F9" stroke="#0B1220" stroke-width="2" />
    <rect x="112" y="378" width="360" height="92" rx="14" fill="url(#cellgrid)" opacity="0.8" />

    <g filter="url(#glow)">
      <rect x="96" y="378" width="120" height="92" fill="url(#accent)" opacity="0.16">
        <animate attributeName="x" values="96;332;96" dur="4.8s" repeatCount="indefinite" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
      </rect>
    </g>

    <g stroke="#0B1220" stroke-width="1">
      <rect x="126" y="392" width="42" height="14" rx="4" fill="#BAE6FD" opacity="0.85" />
      <rect x="178" y="410" width="42" height="14" rx="4" fill="#DDD6FE" opacity="0.85" />
      <rect x="230" y="428" width="42" height="14" rx="4" fill="#FBCFE8" opacity="0.85" />
      <rect x="282" y="446" width="42" height="14" rx="4" fill="#BAE6FD" opacity="0.70" />
      <rect x="334" y="410" width="42" height="14" rx="4" fill="#FBCFE8" opacity="0.55" />
      <rect x="386" y="392" width="42" height="14" rx="4" fill="#DDD6FE" opacity="0.55" />
    </g>

    <text x="112" y="494" font-size="11" fill="#334155">s=W_r x_t, I=topk(s,k), w=softmax(s[I]), y=sum w_i E_i(x)</text>

    <!-- Attention band panel -->
    <g filter="url(#shadow)">
      <rect x="520" y="308" width="320" height="192" rx="18" fill="#FFFFFF" opacity="0.70" stroke="#0B1220" stroke-width="2" />
    </g>
    <rect x="520" y="308" width="320" height="6" rx="18" fill="url(#accent)" opacity="0.92" />
    <text x="540" y="340" font-size="14" font-weight="800" fill="#0B1220">Attention Band</text>
    <text x="540" y="362" font-size="12" fill="#334155">causal + window + sinks as additive bias</text>

    <g clip-path="url(#clipAttn)">
      <rect x="540" y="380" width="240" height="120" rx="14" fill="#F1F5F9" />
      <path d="M540 380 L540 500 L780 500 Z" fill="#CBD5E1" opacity="0.60" />
      <rect x="540" y="380" width="240" height="120" fill="url(#cellgrid)" opacity="0.85" />

      <g transform="rotate(45 660 440)" filter="url(#glow)">
        <rect x="-260" y="428" width="120" height="26" rx="10" fill="url(#accent)" opacity="0.68">
          <animate attributeName="x" values="-260;60;-260" dur="4.6s" repeatCount="indefinite" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
        </rect>
      </g>
    </g>
    <rect x="540" y="380" width="240" height="120" rx="14" fill="none" stroke="#0B1220" stroke-width="2" />

    <text x="540" y="494" font-size="11" fill="#334155">A=softmax((QK^T)/sqrt(d)+B), Y=AV</text>

    <!-- KV cache panel -->
    <g filter="url(#shadow)">
      <rect x="860" y="308" width="252" height="192" rx="18" fill="#FFFFFF" opacity="0.70" stroke="#0B1220" stroke-width="2" />
    </g>
    <rect x="860" y="308" width="252" height="6" rx="18" fill="url(#accent)" opacity="0.92" />
    <text x="880" y="340" font-size="14" font-weight="800" fill="#0B1220">KV Cache</text>
    <text x="880" y="362" font-size="12" fill="#334155">append-only offset</text>

    <rect x="880" y="382" width="212" height="30" rx="12" fill="#F1F5F9" stroke="#0B1220" stroke-width="2" />
    <rect x="888" y="390" width="110" height="14" rx="8" fill="#BAE6FD" opacity="0.85" stroke="#0B1220" stroke-width="1" />

    <g filter="url(#glow)">
      <rect x="1002" y="390" width="16" height="14" rx="6" fill="url(#accent)" opacity="0.95">
        <animate attributeName="x" values="1002;1078;1002" dur="4.8s" repeatCount="indefinite" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
      </rect>
    </g>

    <text x="880" y="440" font-size="12" fill="#334155">bytes ~= 2*L*B*T*H_kv*d*dtype</text>
    <text x="880" y="462" font-size="12" fill="#334155">RoPE pos uses absolute t</text>
  </g>

  <!-- scanline across the whole card -->
  <rect x="60" y="150" width="1080" height="42" fill="url(#scan)" opacity="0.22">
    <animate attributeName="y" dur="7.0s" repeatCount="indefinite" values="150;468;150" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
  </rect>

  <text x="60" y="548" fill="#334155" font-size="12" font-family="JetBrains Mono, 'Courier New', monospace">Option 01: single-slide blueprint (pipeline + micro-panels). Pick one option to embed under Overview.</text>
</svg>
