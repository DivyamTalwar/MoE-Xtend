<svg width="1200" height="560" viewBox="0 0 1200 560" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#F8FAFC" />
      <stop offset="45%" stop-color="#E0F2FE" />
      <stop offset="100%" stop-color="#FCE7F3" />
    </linearGradient>
    <linearGradient id="accent" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#06B6D4" />
      <stop offset="50%" stop-color="#8B5CF6" />
      <stop offset="100%" stop-color="#EC4899" />
    </linearGradient>
    <linearGradient id="scan" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#FFFFFF" stop-opacity="0" />
      <stop offset="50%" stop-color="#FFFFFF" stop-opacity="0.38" />
      <stop offset="100%" stop-color="#FFFFFF" stop-opacity="0" />
    </linearGradient>
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#CBD5E1" stroke-width="1" />
    </pattern>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="10" stdDeviation="10" flood-color="#0B1220" flood-opacity="0.14" />
    </filter>
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="5" result="b" />
      <feColorMatrix in="b" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.65 0" result="g" />
      <feMerge>
        <feMergeNode in="g" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
    <linearGradient id="lane" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#22D3EE" stop-opacity="0.0" />
      <stop offset="50%" stop-color="#22D3EE" stop-opacity="0.45" />
      <stop offset="100%" stop-color="#22D3EE" stop-opacity="0.0" />
    </linearGradient>
  </defs>

  <rect width="1200" height="560" fill="url(#bg)" />
  <rect width="1200" height="560" fill="url(#grid)" opacity="0.25" />

  <text x="60" y="70" fill="#0B1220" font-size="34" font-weight="800" font-family="Space Grotesk, Helvetica, Arial, sans-serif">MoE-Xtend: Context Highway (Windows + Sinks + KV)</text>
  <text x="60" y="104" fill="#334155" font-size="14" font-family="JetBrains Mono, 'Courier New', monospace">Long context is a moving window over an ever-growing KV cache. This view shows sinks, window banding, and decode offset.</text>
  <rect x="60" y="124" width="1080" height="6" fill="url(#accent)" />

  <!-- main card -->
  <g filter="url(#shadow)">
    <rect x="60" y="150" width="1080" height="360" rx="22" fill="#FFFFFF" opacity="0.66" stroke="#0B1220" stroke-width="2" />
  </g>

  <!-- context timeline -->
  <g font-family="JetBrains Mono, 'Courier New', monospace" fill="#0B1220">
    <text x="92" y="190" font-size="14" font-weight="800">1) Context Timeline (T)</text>
    <text x="92" y="212" font-size="12" fill="#334155">decode step t scans right; attention sees a band of keys (window W) plus sink tokens</text>
  </g>

  <rect x="92" y="232" width="1016" height="52" rx="18" fill="#F1F5F9" stroke="#0B1220" stroke-width="2" />
  <!-- sink region -->
  <rect x="102" y="244" width="140" height="28" rx="12" fill="#BAE6FD" opacity="0.85" stroke="#0B1220" stroke-width="1" />
  <text x="110" y="264" font-family="JetBrains Mono, 'Courier New', monospace" font-size="12" fill="#0B1220">sinks</text>

  <!-- moving window band -->
  <g filter="url(#glow)">
    <rect x="260" y="244" width="280" height="28" rx="12" fill="url(#accent)" opacity="0.20">
      <animate attributeName="x" values="260;780;260" dur="6.2s" repeatCount="indefinite" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
    </rect>
    <rect x="320" y="244" width="44" height="28" rx="10" fill="url(#accent)" opacity="0.70">
      <animate attributeName="x" values="320;1010;320" dur="6.2s" repeatCount="indefinite" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
    </rect>
  </g>

  <g font-family="JetBrains Mono, 'Courier New', monospace" font-size="12" fill="#334155">
    <text x="92" y="304">left: early tokens</text>
    <text x="948" y="304">right: later tokens</text>
  </g>

  <!-- token stream wave over timeline -->
  <path d="M110 332 C 250 280, 400 280, 540 332 S 820 384, 960 332 S 1030 300, 1108 332" fill="none" stroke="url(#accent)" stroke-width="3" filter="url(#glow)" />
  <path d="M110 350 C 250 402, 400 402, 540 350 S 820 298, 960 350 S 1030 382, 1108 350" fill="none" stroke="#22D3EE" stroke-width="2" opacity="0.7" stroke-dasharray="3 10">
    <animate attributeName="stroke-dashoffset" values="0;90" dur="2.6s" repeatCount="indefinite" />
  </path>

  <!-- KV cache map + bytes -->
  <g font-family="JetBrains Mono, 'Courier New', monospace" fill="#0B1220">
    <text x="92" y="392" font-size="14" font-weight="800">2) KV Cache Bytes</text>
    <text x="92" y="414" font-size="12" fill="#334155">memory grows with T; GQA reduces H_kv; windows reduce per-step compute</text>
  </g>

  <g filter="url(#shadow)">
    <rect x="92" y="430" width="720" height="70" rx="18" fill="#FFFFFF" opacity="0.72" stroke="#0B1220" stroke-width="2" />
  </g>
  <rect x="92" y="430" width="720" height="6" rx="18" fill="url(#accent)" opacity="0.92" />

  <g font-family="JetBrains Mono, 'Courier New', monospace" font-size="12" fill="#334155">
    <text x="112" y="468">bytes ~= 2 * L * B * T * H_kv * d * dtype_bytes</text>
    <text x="112" y="490">decode: write KV[t] at offset, then offset++ (absolute RoPE position = t)</text>
  </g>

  <!-- RoPE scaling zones bar -->
  <g filter="url(#shadow)">
    <rect x="832" y="430" width="276" height="70" rx="18" fill="#FFFFFF" opacity="0.72" stroke="#0B1220" stroke-width="2" />
  </g>
  <rect x="832" y="430" width="276" height="6" rx="18" fill="url(#accent)" opacity="0.92" />

  <g font-family="JetBrains Mono, 'Courier New', monospace" fill="#0B1220">
    <text x="852" y="462" font-size="13" font-weight="800">RoPE Zones</text>
    <text x="852" y="484" font-size="11" fill="#334155">fast / blend / slow</text>
  </g>

  <g>
    <rect x="852" y="490" width="236" height="12" rx="6" fill="#E2E8F0" stroke="#0B1220" stroke-width="1" opacity="0.9" />
    <rect x="852" y="490" width="74" height="12" rx="6" fill="#06B6D4" opacity="0.75" />
    <rect x="926" y="490" width="86" height="12" rx="0" fill="#8B5CF6" opacity="0.60" />
    <rect x="1012" y="490" width="76" height="12" rx="6" fill="#EC4899" opacity="0.65" />

    <g filter="url(#glow)">
      <rect x="852" y="488" width="44" height="16" rx="8" fill="url(#accent)" opacity="0.60">
        <animate attributeName="x" values="852;1044;852" dur="4.8s" repeatCount="indefinite" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
      </rect>
    </g>
  </g>

  <!-- scanline -->
  <rect x="60" y="150" width="1080" height="42" fill="url(#scan)" opacity="0.22">
    <animate attributeName="y" dur="7.2s" repeatCount="indefinite" values="150;468;150" keyTimes="0;0.5;1" calcMode="spline" keySplines="0.42 0 0.58 1;0.42 0 0.58 1" />
  </rect>

  <text x="60" y="548" fill="#334155" font-size="12" font-family="JetBrains Mono, 'Courier New', monospace">Option 03: context highway (timeline + moving window + bytes + RoPE zones).</text>
</svg>
